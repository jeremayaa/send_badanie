{% extends 'core/base.html' %}
{% block title %}Analiza – {{ badanie.nazwa }}{% endblock %}
{% block content %}
  <h2>Analiza w programie: {{ badanie.nazwa }}</h2>

  <!-- schowaj oryginalny <img>, wrzucimy do canvas -->
  <img id="orig-img" src="{{ badanie.zdjecie.url }}" style="display:none;">
  <canvas id="canvas"></canvas>

  <p>
    <button id="bw-btn">Czarnobiałe</button>
    <button id="save-analysis-btn">Zapisz analizę</button>
  </p>

  <script>
    // Przygotuj canvas
    const img = document.getElementById('orig-img');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    img.onload = () => {
      canvas.width = img.naturalWidth;
      canvas.height = img.naturalHeight;
      ctx.drawImage(img, 0, 0);
    };

    // Czarnobiałe – używamy filtra canvas
    document.getElementById('bw-btn').onclick = () => {
      ctx.filter = 'grayscale(100%)';
      ctx.drawImage(img, 0, 0);
    };

    // Zapisz → przechowaj obraz w localStorage i otwórz formularz analizy
    document.getElementById('save-analysis-btn').onclick = () => {
      const dataURL = canvas.toDataURL('image/png');
      localStorage.setItem('bwImage', dataURL);
      window.open(
         "{% url 'core:analiza-add-program' badanie_pk=badanie.pk %}"
      );
    };
  </script>
{% endblock %}
