{% extends 'core/base.html' %}
{% block title %}{{ title }} – analiza w programie{% endblock %}
{% block content %}
  <h2>Programowa analiza: {{ title }}</h2>

  <img id="orig-img" src="{{ image_url }}" style="display:none">
  <canvas id="canvas"></canvas>

  <p>
    <button id="bw-btn">Czarnobiałe</button>
    <button id="save-btn">Zapisz analizę</button>
  </p>

  <script>
    const img = document.getElementById('orig-img');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    img.onload = () => {
      canvas.width = img.naturalWidth;
      canvas.height = img.naturalHeight;
      ctx.drawImage(img, 0, 0);
    };
    document.getElementById('bw-btn').onclick = () => {
      ctx.filter = 'grayscale(100%)';
      ctx.drawImage(img, 0, 0);
    };
    document.getElementById('save-btn').onclick = () => {
      const dataURL = canvas.toDataURL('image/png');
      localStorage.setItem('bwImage', dataURL);
      window.location.href = "{{ redirect_url }}";
    };
  </script>
{% endblock %}
