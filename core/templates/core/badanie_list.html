{% extends 'core/base.html' %}
{% block title %}Badania{% endblock %}
{% block content %}
  <h2>Badania</h2>

  <p>
    <a href="{% url 'core:badanie-add' %}">+ Nowe badanie</a>
    &nbsp;|&nbsp;
    <button type="button" id="toggle-filter-btn">Filtruj po tagach</button>
  </p>

  <div id="filter-container" style="display:none; margin-left:1em;">
    <form method="get">
      {% for tag in all_tags %}
        <label>
          <input type="checkbox"
                 name="tags"
                 value="{{ tag.pk }}"
                 {% if tag.pk in selected_tags %}checked{% endif %}>
          {{ tag.nazwa }}
        </label><br>
      {% endfor %}
      <button type="submit">Filtruj</button>
      <a href="{% url 'core:badanie-list' %}">Wyczyść</a>
    </form>
  </div>

  <ul>
    {% for badanie in badania %}
      <li>
        <a href="{% url 'core:badanie-detail' badanie.pk %}">
          {{ badanie.nazwa }}
        </a>
        {% if badanie.tagi.all %}
          [{{ badanie.tagi.all|join:", " }}]
        {% endif %}
      </li>
    {% empty %}
      <li>Brak badań.</li>
    {% endfor %}
  </ul>

  <script>
    document.getElementById('toggle-filter-btn').onclick = () => {
      const f = document.getElementById('filter-container');
      f.style.display = f.style.display === 'none' ? 'block' : 'none';
    };
  </script>
{% endblock %}
